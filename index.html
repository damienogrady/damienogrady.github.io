<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    #mapCanvas {
      background-color: lightgray;
      background-image: url('small_world.jpg');
      width: 640px;
      height: 432px;
    }
    #odometer {
      font-size: 24px;
      margin-top: 20px;
    }
    .video-container {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>
  <div class="video-container">
    <video width="640" height="360" autoplay muted loop>
      <source src="nathan.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </div>
  <div>
  <h1>Nathan Location and Ideation Dashboard</h1>
      <h2>Instructions:</h2>  <p>The image shows the best current estimation as to Nathan's position in the space-time continuum,
        along with his speed of ideas and verbal expression.
        However, due to the dictates of the Heisenberg Uncertainty
        Principle, Nathan's location AND verbosity cannot <b>both</b> be
        determined at the same time.  The way to gauge the current velocity of
        our director's speech and idea production, you must click on his icon.  This
        will momentarily consign Nathan's momentum to Schr√∂dinger's box, allowing his 
        current verbosity to be displayed on the speedometer.
      </p>
      <h2>Warning!</h2>If you miss our venerable leader's head when you click, quantum entanglement will increase his velocity,
      which could have devastating effects! Five such misses have been known to replace speach
      altogether with the contented grin of eternal enlightenment...
  </div>
  <h2>Nathan Location</h2>
  <canvas id="mapCanvas"></canvas>
  <!-- <div id="odometer"></div> -->
  <div id="speedometer">
    <h2>Verbosity Velocity</h2>
      <div style="display: none;"><img id="sprite" src="assets/icons.svg"></div>
      <canvas id="canvas" width="425" height="210"></canvas>
  </div>

  <script src="js/fraction.min.js"></script>
  <script src="js/speedometer.js"></script>

  <script>
    window.addEventListener('DOMContentLoaded', function() {
      var clickCount = 0;
      var videoContainer = document.querySelector('.video-container');
      var mapCanvas = document.getElementById('mapCanvas');

      function handleMapClick() {
        clickCount++;
        if (clickCount === 5) {
          videoContainer.style.display = 'block';
          mapCanvas.removeEventListener('click', handleMapClick);
        }
      }

      mapCanvas.addEventListener('click', handleMapClick);
    });
  </script>
  <script>
// Get the canvas element and set its dimensions
const mapcanvas = document.getElementById('mapCanvas');
const ctx2 = mapcanvas.getContext('2d');
mapcanvas.width = 640;
mapcanvas.height = 432;

// Set the initial dot position and velocity
let dotX = mapcanvas.width / 2;
let dotY = mapcanvas.height / 2;
let velocityX = 1; // Initial velocity along the x-axis
let velocityY = 1; // Initial velocity along the y-axis

// Create an image element for the dot
const dotImage = new Image();
dotImage.src = 'small_dot.jpg';

// Function to update the dot position and odometer speed
function updateDashboard() {
  // Update dot position
  dotX += velocityX;
  dotY += velocityY;

  // Check if the dot reaches the edges of the map and change velocity direction accordingly
  if (dotX <= 0 || dotX >= mapcanvas.width) {
    velocityX *= -1;
  }
  if (dotY <= 0 || dotY >= mapcanvas.height) {
    velocityY *= -1;
  }

  // Clear the mapcanvas
  ctx2.clearRect(0, 0, mapcanvas.width, mapcanvas.height);

  // Draw the map background image
  // ctx2.drawImage(canvas.backgroundImage, 0, 0, canvas.width, canvas.height);

  // Draw the dot image
  ctx2.drawImage(dotImage, dotX - dotImage.width / 2, dotY - dotImage.height / 2);

  // Update odometer with random speed
  const speed = Math.sqrt(velocityX ** 2 + velocityY ** 2);
  // document.getElementById('odometer').innerText = 'Speed: ' + speed.toFixed(2) + ' km/h';

  // Schedule the next update
  requestAnimationFrame(updateDashboard);
}

// Start the dashboard update
dotImage.onload = updateDashboard;

// Function to update the dot position and odometer speed
function updateSpeedo() {
  // Update odometer with random speed
  const speed = Math.random();
  // document.getElementById('odometer').innerText = 'Speed: ' + speed.toFixed(2) + ' km/h';

  // Schedule the next update
  setTimeout(updateDashboard, 2000);

  tacho = Math.random();
  gas = Math.random();
  mileage = Math.round(Math.random() * 100000);

  let turnSignalsStates = {
    left: true,
    right: true,
  };

  let iconsStates = {
    // main circle
    dippedBeam: 1,
    brake: 1,
    drift: 1,
    highBeam: 1,
    lock: 1,
    seatBelt: 1,
    engineTemp: 2,
    stab: 1,
    abs: 1,
    // right circle
    gas: 2,
    trunk: 1,
    bonnet: 1,
    doors: 1,
    // left circle
    battery: 2,
    oil: 2,
    engineFail: 2,
  };
  draw(speed, tacho, gas, mileage, turnSignalsStates, iconsStates);
}

// Add a click event listener to the dotImage
mapcanvas.addEventListener('click', updateSpeedo);

  </script>
  <script>

    // Function to update the dot position and odometer speed
    function updateSpeedo() {

      // Update odometer with random speed
      const speed = Math.random();
      // document.getElementById('odometer').innerText = 'Speed: ' + speed.toFixed(2) + ' km/h';

      // Schedule the next update
      setTimeout(updateDashboard, 2000);

      tacho = Math.random();
      gas = Math.random();
      mileage = Math.round(Math.random() * 100000)

      let turnSignalsStates = {
          'left':  true,
          'right': true
      }

      let iconsStates = {
          // main circle
          'dippedBeam': 1,
          'brake':      1,
          'drift':      1,
          'highBeam':   1,
          'lock':       1,
          'seatBelt':   1,
          'engineTemp': 2,
          'stab':       1,
          'abs':        1,
          // right circle
          'gas':        2,
          'trunk':      1,
          'bonnet':     1,
          'doors':      1,
          // left circle
          'battery':    2,
          'oil':        2,
          'engineFail': 2
      }
      draw(speed, tacho, gas, mileage, turnSignalsStates, iconsStates);
    }

    // Start the dashboard update
    updateSpeedo();
  </script>
</body>
</html>
